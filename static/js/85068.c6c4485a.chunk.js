"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[85068],{786141:(e,t,n)=>{n.r(t),n.d(t,{VaultBase:()=>B,VaultBaseChainOnly:()=>P});var r=n(72579),o=n.n(r),i=n(256666),a=n(301842),u=n.n(a),s=n(634795),c=n(887371),d=n(545754),l=n(411987),f=n(695058),p=n(206391),v=n.n(p),h=n(636393),y=n(613549),g=n(292147),w=n(213208),m=n(992431),I=n(940915),T=n(278489),x=n(969618),b=n(398514),A=n(114540),E=n(348834).Buffer;function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function O(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,f.default)(e);if(t){var o=(0,f.default)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,l.default)(this,n)}}if(w.default.isExtensionUi)throw new Error("engine/VaultBase is not allowed imported from ui");var P=function(e){(0,d.default)(n,e);var t=O(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.initProvider=function(){var e=(0,s.default)((function*(){var e=(yield this.getNetwork()).impl;u()(x.IMPL_MAPPINGS[e])||(this.engineProvider=yield this.engine.providerManager.getProvider(this.networkId))}));return function(){return e.apply(this,arguments)}}(),r.proxyJsonRPCCall=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.createClientFromURL=function(e){throw new I.NotImplemented},r.getEthersProvider=function(){var e=(0,s.default)((function*(){throw new I.NotImplemented}));return function(){return e.apply(this,arguments)}}(),r.getClientEndpointStatus=function(){var e=(0,s.default)((function*(e){var t=this.createClientFromURL(e),n=performance.now(),r=(yield t.getInfo()).bestBlockNumber;return{responseTime:Math.floor(performance.now()-n),latestBlock:r}}));return function(t){return e.apply(this,arguments)}}(),r.checkRpcBatchSupport=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.getDisplayAddress=function(){var e=(0,s.default)((function*(e){return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),r.validateAddress=function(){var e=(0,s.default)((function*(e){var t=yield this.engineProvider.verifyAddress(e),n=t.normalizedAddress;if(!t.isValid||!n)throw new I.InvalidAddress;return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),r.validateImportedCredential=function(e){return Promise.resolve(this.settings.importedAccountEnabled&&/^(0x)?[0-9a-zA-Z]{64}$/.test(e))},r.validateWatchingCredential=function(){var e=(0,s.default)((function*(e){return Promise.resolve(this.settings.watchingAccountEnabled&&(yield this.engineProvider.verifyAddress(e)).isValid)}));return function(t){return e.apply(this,arguments)}}(),r.validateTokenAddress=function(){var e=(0,s.default)((function*(e){var t=yield this.engineProvider.verifyTokenAddress(e),n=t.normalizedAddress;if(!t.isValid||"undefined"===typeof n)throw new I.InvalidTokenAddress;return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),r.validateCanCreateNextAccount=function(){var e=(0,s.default)((function*(e,t){return Promise.resolve(!0)}));return function(t,n){return e.apply(this,arguments)}}(),r.checkAccountExistence=function(){var e=(0,s.default)((function*(e,t){return Promise.resolve(!0)}));return function(t,n){return e.apply(this,arguments)}}(),r.getBalances=function(){var e=(0,s.default)((function*(e,t,n){return(yield this.engine.providerManager.getClient(this.networkId)).getBalances(e.map((function(e){var t=e.address,n=e.tokenAddress;return{address:t,coin:C({},"string"===typeof n?{tokenAddress:n}:{})}})))}));return function(t,n,r){return e.apply(this,arguments)}}(),r.getFrozenBalance=function(){var e=(0,s.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance;return 0}));return function(){return e.apply(this,arguments)}}(),r.fetchBalanceDetails=function(){var e=(0,s.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance;return Promise.resolve(void 0)}));return function(){return e.apply(this,arguments)}}(),r.getTransactionStatuses=function(e){return this.engine.providerManager.getTransactionStatuses(this.networkId,e)},r.getTransactionFeeInNative=function(e){return Promise.resolve("")},r.isContractAddress=function(){var e=(0,s.default)((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),r.getAccountNameInfoMap=function(){var e=(0,s.default)((function*(){var e=yield this.getNetwork();return(0,T.getAccountNameInfoByImpl)(e.impl)}));return function(){return e.apply(this,arguments)}}(),r.canAutoCreateNextAccount=function(){var e=(0,s.default)((function*(e){return Promise.resolve(!1)}));return function(t){return e.apply(this,arguments)}}(),r.filterAccounts=function(){var e=(0,s.default)((function*(e){var t=e.accounts;e.networkId;return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),r.shouldChangeAccountWhenNetworkChanged=function(){var e=(0,s.default)((function*(e){e.previousNetwork,e.newNetwork,e.activeAccountId;return Promise.resolve({shouldReloadAccountList:!1,shouldChangeActiveAccount:!1})}));return function(t){return e.apply(this,arguments)}}(),r.getAccountNameInfosByImportedOrWatchingCredential=function(){var e=(0,s.default)((function*(e){return Promise.resolve([])}));return function(t){return e.apply(this,arguments)}}(),r.checkIsUnlimitedAllowance=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.checkIsApprovedForAll=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.checkIsBatchTransfer=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.getFeePricePerUnit=function(){var e=(0,s.default)((function*(){throw new I.NotImplemented}));return function(){return e.apply(this,arguments)}}(),r.fetchRpcChainId=function(){var e=(0,s.default)((function*(e){return null}));return function(t){return e.apply(this,arguments)}}(),r.getTxWaitingSeconds=function(){var e=(0,s.default)((function*(){return[]}));return function(){return e.apply(this,arguments)}}(),r.getUserNFTAssets=function(){var e=(0,s.default)((function*(e){e.serviceData;return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),(0,c.default)(n)}(A.VaultContext),B=function(e){(0,d.default)(n,e);var t=O(n);function n(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).uuid=h.default.v4().toString(),e}var r=n.prototype;return r.init=function(){var e=(0,s.default)((function*(e){yield this.initProvider(),yield this.initKeyring(e)}));return function(t){return e.apply(this,arguments)}}(),r.initKeyring=function(){var e=(0,s.default)((function*(e){this.keyring=yield e.keyringCreator(this)}));return function(t){return e.apply(this,arguments)}}(),r.signTransaction=function(){var e=(0,s.default)((function*(e,t){return this.keyring.signTransaction(e,t)}));return function(t,n){return e.apply(this,arguments)}}(),r.signAndSendTransaction=function(){var e=(0,s.default)((function*(e,t,n){var r=yield this.signTransaction(e,t);return n?C(C({},r),{},{encodedTx:e.encodedTx}):this.broadcastTransaction(C(C({},r),{},{encodedTx:e.encodedTx}))}));return function(t,n,r){return e.apply(this,arguments)}}(),r.broadcastTransaction=function(){var e=(0,s.default)((function*(e,t){g.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var n=yield this.engine.providerManager.broadcastTransaction(this.networkId,e.rawTx,t);return g.default.engine.info("broadcastTransaction END:",{txid:n,rawTx:e.rawTx}),C(C({},e),{},{txid:n,encodedTx:e.encodedTx})}));return function(t,n){return e.apply(this,arguments)}}(),r.buildEncodedTxFromBatchTransfer=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.buildEncodedTxsFromSetApproveForAll=function(){var e=(0,s.default)((function*(e,t){throw new I.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),r.activateAccount=function(){var e=(0,s.default)((function*(){throw new I.NotImplemented}));return function(){return e.apply(this,arguments)}}(),r.activateToken=function(){var e=(0,s.default)((function*(e,t){throw new I.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),r.getTokenAllowance=function(){var e=(0,s.default)((function*(e,t){throw new I.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),r.batchTokensAllowance=function(){var e=(0,s.default)((function*(e,t){throw new I.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),r.getOutputAccount=function(){var e=(0,s.default)((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,template:e.template,pubKey:o()(e,"pub","")}}));return function(){return e.apply(this,arguments)}}(),r.getAccountBalance=function(){var e=(0,s.default)((function*(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,o=(yield this.getDbAccount()).address;return this.getBalances((t?[{address:o}]:[]).concat(e.map((function(e){return{address:o,tokenAddress:e}}))),n,r)}));return function(t){return e.apply(this,arguments)}}(),r.updatePendingTxs=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.getAccountNonce=function(){var e=(0,s.default)((function*(){return Promise.resolve(null)}));return function(){return e.apply(this,arguments)}}(),r.fixActionDirection=function(){var e=(0,s.default)((function*(e){var t,n,r,o,i=e.action,a=e.accountAddress;(i.direction=b.IDecodedTxDirection.OTHER,i.type===b.IDecodedTxActionType.NATIVE_TRANSFER)&&(i.direction=yield this.buildTxActionDirection({from:(null==(t=i.nativeTransfer)?void 0:t.from)||"",to:(null==(n=i.nativeTransfer)?void 0:n.to)||"",address:a}));i.type===b.IDecodedTxActionType.TOKEN_TRANSFER&&(i.direction=yield this.buildTxActionDirection({from:(null==(r=i.tokenTransfer)?void 0:r.from)||"",to:(null==(o=i.tokenTransfer)?void 0:o.to)||"",address:a}));return i}));return function(t){return e.apply(this,arguments)}}(),r.fixDecodedTx=function(){var e=(0,s.default)((function*(e){var t,n;e.createdAt=null!=(t=e.createdAt)?t:Date.now();var r=null==(n=e.encodedTx)?void 0:n.nonce;e.nonce=u()(r)?e.nonce:new(v())(r).toNumber();for(var o=e.owner,i=0;i<e.actions.length;i+=1){var a=e.actions[i];yield this.fixActionDirection({action:a,accountAddress:o})}if(e.outputActions)for(var s=0;s<e.outputActions.length;s+=1){var c=e.outputActions[s];yield this.fixActionDirection({action:c,accountAddress:o})}return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),r.fixHistoryTx=function(){var e=(0,s.default)((function*(e){return e.decodedTx=yield this.fixDecodedTx(e.decodedTx),Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),r.buildHistoryTx=function(){var e=(0,s.default)((function*(e){var t=e.historyTxToMerge,n=(e.encodedTx,e.decodedTx),r=e.signedTx,o=e.isSigner,i=e.isLocalCreated,a=(null==r?void 0:r.txid)||(null==n?void 0:n.txid)||"";if(!a)throw new Error("buildHistoryTx txid not found");var u=yield this.getAccountAddress();n.txid=a||n.txid,n.owner=u,o&&(n.signer=u),null!=r&&r.txKey&&(n.extraInfo?n.extraInfo.txKey=r.txKey:n.extraInfo={txKey:r.txKey});var s=C(C({id:`${this.networkId}_${a}_${this.accountId}`,isLocalCreated:Boolean(i)},t),{},{decodedTx:n});return s=yield this.fixHistoryTx(s),Promise.resolve(s)}));return function(t){return e.apply(this,arguments)}}(),r.checkIsScamHistoryTx=function(){var e=(0,s.default)((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),r.fetchOnChainHistory=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.fixAddressCase=function(e){return Promise.resolve(e)},r.buildTxActionDirection=function(){var e=(0,s.default)((function*(e){var t=e.from,n=e.to,r=e.address;return t=yield this.fixAddressCase(t||""),n=yield this.fixAddressCase(n),r=yield this.fixAddressCase(r),t===n&&t===r?b.IDecodedTxDirection.SELF:t&&t===r?b.IDecodedTxDirection.OUT:n&&n===r?b.IDecodedTxDirection.IN:b.IDecodedTxDirection.OTHER}));return function(t){return e.apply(this,arguments)}}(),r.getNextNonce=function(){var e=(0,s.default)((function*(e,t){var n,r,o=null!=(n=null==(r=(yield this.engine.providerManager.getAddresses(e,[t.address]))[0])?void 0:r.nonce)?n:0,i=(yield this.engine.getHistory(e,t.id,void 0,!1),yield m.default.history.getMaxPendingNonce({accountId:this.accountId,networkId:e})),a=yield m.default.history.getPendingNonceList({accountId:this.accountId,networkId:e}),s=Math.max(u()(i)?0:i+1,o);if(Number.isNaN(s)&&(s=o),s>o)for(var c=o;c<s;c+=1)if(!a.includes(c)){s=c;break}if(s<o&&(s=o),s-o>=y.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH)throw new I.PendingQueueTooLong(y.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH);return s}));return function(t,n){return e.apply(this,arguments)}}(),r.validateSendAmount=function(e,t,n){return Promise.resolve(!0)},r.notifyChainChanged=function(e,t){},r.getFetchBalanceAddress=function(e){return Promise.resolve(e.address)},r.getPrivateKeyByCredential=function(e){return Promise.resolve(E.from(e.startsWith("0x")?e.slice(2):e,"hex"))},r.getMinDepositAmount=function(){var e=(0,s.default)((function*(){return"0"}));return function(){return e.apply(this,arguments)}}(),r.specialCheckEncodedTx=function(){var e=(0,s.default)((function*(e){return{success:!0}}));return function(t){return e.apply(this,arguments)}}(),r.getAllUsedAddress=function(){var e=(0,s.default)((function*(){return Promise.resolve([])}));return function(){return e.apply(this,arguments)}}(),(0,c.default)(n)}(P)},565147:(e,t,n)=>{n.r(t),n.d(t,{KeyringBase:()=>c,KeyringBaseMock:()=>d});var r=n(634795),o=n(887371),i=n(545754),a=n(411987),u=n(695058);function s(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.default)(e);if(t){var o=(0,u.default)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,a.default)(this,n)}}var c=function(e){(0,i.default)(n,e);var t=s(n);function n(e){var n;return(n=t.call(this,e.options)).vault=e,n}return n.prototype.addressFromBase=function(){var e=(0,r.default)((function*(e){return this.vault.addressFromBase(e)}));return function(t){return e.apply(this,arguments)}}(),(0,o.default)(n)}(n(114540).VaultContext),d=function(e){(0,i.default)(n,e);var t=s(n);function n(){return t.apply(this,arguments)}return(0,o.default)(n)}(c)},82406:(e,t,n)=>{n.r(t),n.d(t,{KeyringHardwareBase:()=>l});var r=n(634795),o=n(887371),i=n(545754),a=n(411987),u=n(695058),s=n(799075),c=n(814817);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.default)(e);if(t){var o=(0,u.default)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,a.default)(this,n)}}var l=function(e){(0,i.default)(a,e);var t=d(a);function a(){return t.apply(this,arguments)}var u=a.prototype;return u.getHardwareInfo=function(){var e=(0,r.default)((function*(){var e,t,n,r=yield this.engine.getHWDeviceByWalletId(this.vault.walletId);return{connectId:null!=(e=null==r?void 0:r.mac)?e:"",deviceId:null!=(t=null==r?void 0:r.deviceId)?t:"",deviceType:null!=(n=null==r?void 0:r.deviceType)?n:""}}));return function(){return e.apply(this,arguments)}}(),u.getWalletPassphraseState=function(){var e=(0,r.default)((function*(){var e=yield this.engine.getWallet(this.vault.walletId);return{passphraseState:null==e?void 0:e.passphraseState,useEmptyPassphrase:!(0,c.isPassphraseWallet)(e)}}));return function(){return e.apply(this,arguments)}}(),u.getHardwareSDKInstance=function(){var e=(0,r.default)((function*(){var e,t,r,o,i;return null!=(i=yield null==(e=n.g)||null==(t=e.$backgroundApiProxy)||null==(r=t.backgroundApi)||null==(o=r.serviceHardware)||null==o.getSDKInstance?void 0:o.getSDKInstance())?i:s.HardwareSDK}));return function(){return e.apply(this,arguments)}}(),u.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,o.default)(a)}(n(565147).KeyringBase)},810887:(e,t,n)=>{n.r(t),n.d(t,{KeyringHdBase:()=>v});var r=n(256666),o=n(634795),i=n(887371),a=n(545754),u=n(411987),s=n(695058),c=n(605851),d=n(940915);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,s.default)(e);if(t){var o=(0,s.default)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,u.default)(this,n)}}var v=function(e){(0,a.default)(n,e);var t=p(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getPrivateKeys=function(){var e=(0,o.default)((function*(e,t){var n=(yield this.getDbAccount()).path.split("/"),r=t||[n.pop()],o=n.join("/"),i=(yield this.engine.dbApi.getCredential(this.walletId,e)).seed;if("undefined"===typeof i)throw new d.OneKeyInternalError("Unable to get credential.");var a=(yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId)).curve;return(0,c.batchGetPrivateKeys)(a,i,e,o,r).reduce((function(e,t){var n;return f(f({},e),{},((n={})[t.path]=t.extendedKey.key,n))}),{})}));return function(t,n){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,i.default)(n)}(n(280306).KeyringSoftwareBase)},255942:(e,t,n)=>{n.r(t),n.d(t,{KeyringImportedBase:()=>d});var r=n(634795),o=n(887371),i=n(545754),a=n(411987),u=n(695058),s=n(940915);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.default)(e);if(t){var o=(0,u.default)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,a.default)(this,n)}}var d=function(e){(0,i.default)(n,e);var t=c(n);function n(){return t.apply(this,arguments)}var a=n.prototype;return a.getPrivateKeys=function(){var e=(0,r.default)((function*(e,t){if("undefined"!==typeof t)throw new s.NotImplemented("Getting private keys from extended private key");var n=(yield this.engine.dbApi.getCredential(this.accountId,e)).privateKey;if("undefined"===typeof n)throw new s.OneKeyInternalError("Unable to get credential.");return{"":n}}));return function(t,n){return e.apply(this,arguments)}}(),a.getAddress=function(){throw new Error("Method not implemented.")},a.batchGetAddress=function(){throw new Error("Method not implemented.")},a.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,o.default)(n)}(n(280306).KeyringSoftwareBase)},280306:(e,t,n)=>{n.r(t),n.d(t,{KeyringSoftwareBase:()=>h});var r=n(196234),o=n(256666),i=n(634795),a=n(887371),u=n(545754),s=n(411987),c=n(695058),d=n(292147),l=n(940915);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){(0,o.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,c.default)(e);if(t){var o=(0,c.default)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,s.default)(this,n)}}var h=function(e){(0,u.default)(n,e);var t=v(n);function n(){return t.apply(this,arguments)}var o=n.prototype;return o.signTransaction=function(){var e=(0,i.default)((function*(e,t){var n=t.password;if("undefined"===typeof n)throw new l.OneKeyInternalError("Software signing requires a password.");var r=yield this.getSigners(n,e.inputs.map((function(e){return e.address})));return d.default.engine.info("signTransaction",this.networkId,e),p(p({},yield this.engine.providerManager.signTransaction(this.networkId,e,r)),{},{encodedTx:e.encodedTx})}));return function(t,n){return e.apply(this,arguments)}}(),o.signMessage=function(){var e=(0,i.default)((function*(e,t){var n=this,o=t.password;if("undefined"===typeof o)throw new l.OneKeyInternalError("Software signing requires a password.");var i=yield this.getDbAccount(),a=Object.values(yield this.getSigners(o,[i.address])),u=(0,r.default)(a,1)[0];return d.default.engine.info("signMessage",this.networkId,e),Promise.all(e.map((function(e){return n.engine.providerManager.signMessage(n.networkId,e,u)})))}));return function(t,n){return e.apply(this,arguments)}}(),o.getAddress=function(){throw new Error("Method not implemented.")},o.batchGetAddress=function(){throw new Error("Method not implemented.")},o.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,a.default)(n)}(n(565147).KeyringBase)},701625:(e,t,n)=>{n.r(t),n.d(t,{KeyringWatchingBase:()=>d});var r=n(634795),o=n(887371),i=n(545754),a=n(411987),u=n(695058),s=n(940915);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.default)(e);if(t){var o=(0,u.default)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,a.default)(this,n)}}var d=function(e){(0,i.default)(n,e);var t=c(n);function n(){return t.apply(this,arguments)}var a=n.prototype;return a.signTransaction=function(){var e=(0,r.default)((function*(e,t){throw new s.OneKeyInternalError("signTransaction is not supported for watching accounts")}));return function(t,n){return e.apply(this,arguments)}}(),a.signMessage=function(){var e=(0,r.default)((function*(e,t){throw new s.OneKeyInternalError("signMessage is not supported for watching accounts")}));return function(t,n){return e.apply(this,arguments)}}(),a.getAddress=function(){throw new Error("Method not implemented.")},a.batchGetAddress=function(){throw new Error("Method not implemented.")},a.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,o.default)(n)}(n(565147).KeyringBase)},479480:(e,t,n)=>{n.r(t),n.d(t,{KeyringHardware:()=>E});var r=n(968079),o=n(256666),i=n(634795),a=n(887371),u=n(545754),s=n(411987),c=n(695058),d=n(376314),l=n(153546),f=n(799075),p=n(613549),v=n(292147),h=n(940915),y=n(997293),g=n(278489),w=n(398145),m=n(82406),I=n(16280),T=n(348834).Buffer;function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){(0,o.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function A(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,c.default)(e);if(t){var o=(0,c.default)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,s.default)(this,n)}}var E=function(e){(0,u.default)(n,e);var t=A(n);function n(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).buildHardwareInput=function(){var e=(0,i.default)((function*(e,t){var n=yield(0,f.CoreSDKLoader)(),r=n.getHDPath,o=n.getScriptType,i=r(t),a=o(i),u=e.utxo;return{prev_index:u.vout,prev_hash:u.txid,amount:u.value.integerValue().toString(),address_n:i,script_type:a}}));return function(t,n){return e.apply(this,arguments)}}(),e.buildHardwareOutput=function(){var e=(0,i.default)((function*(e){var t=e.payload||{},n=t.isCharge,r=t.bip44Path;if(n&&r){var o=yield(0,f.CoreSDKLoader)(),i=o.getHDPath,a=o.getOutputScriptType,u=i(r);return{script_type:a(u),address_n:u,amount:e.value.integerValue().toString()}}return{script_type:"PAYTOADDRESS",address:e.address,amount:e.value.integerValue().toString()}}));return function(t){return e.apply(this,arguments)}}(),e.buildPrevTx=function(e){var t=d.Transaction.fromHex(e);return{hash:t.getId(),version:t.version,inputs:t.ins.map((function(e){return{prev_hash:e.hash.reverse().toString("hex"),prev_index:e.index,script_sig:e.script.toString("hex"),sequence:e.sequence}})),bin_outputs:t.outs.map((function(e){return{amount:e.value,script_pubkey:e.script.toString("hex")}})),lock_time:t.locktime}},e}var o=n.prototype;return o.signTransaction=function(){var e=(0,i.default)((function*(e){var t=this,n=e.inputs,r=e.outputs,o=this.vault.getCoinName(),a=e.inputs.map((function(e){return e.address})),u=(yield this.vault.collectUTXOsInfo({checkInscription:!1})).utxos,s={};for(var c of u){var p=c.address,v=c.path;a.includes(p)&&(s[p]=v)}var h=yield this.vault.getProvider(),y=Array.from(new Set(n.map((function(e){return e.utxo.txid})))),g=yield h.collectTxs(y),w=yield this.getHardwareInfo(),m=w.connectId,I=w.deviceId,T=yield this.getWalletPassphraseState();yield this.getHardwareSDKInstance();var x=yield f.HardwareSDK.btcSignTransaction(m,I,b({coin:o.toLowerCase(),inputs:yield Promise.all(n.map(function(){var e=(0,i.default)((function*(e){return t.buildHardwareInput(e,s[e.address])}));return function(t){return e.apply(this,arguments)}}())),outputs:yield Promise.all(r.map(function(){var e=(0,i.default)((function*(e){return t.buildHardwareOutput(e)}));return function(t){return e.apply(this,arguments)}}())),refTxs:Object.values(g).map((function(e){return t.buildPrevTx(e)}))},T));if(x.success){var A=x.payload.serializedTx;return{txid:d.Transaction.fromHex(A).getId(),rawTx:A}}throw(0,l.convertDeviceError)(x.payload)}));return function(t){return e.apply(this,arguments)}}(),o.prepareAccounts=function(){var e=(0,i.default)((function*(e){var t=e.indexes,n=e.purpose,r=e.names,o=e.template,a=e.skipCheckAccountExist,u=e.confirmOnDevice,s=yield this.vault.getProvider(),c=yield this.createAccount({indexes:t,purpose:n,names:r,template:o,addressIndex:0,isChange:!1,isCustomAddress:!1,confirmOnDevice:u,validator:a?void 0:function(){var e=(0,i.default)((function*(e){var t=e.xpub,n=e.addressEncoding;return(yield s.getAccount({type:"simple",xpub:t},n)).txs>0}));return function(t){return e.apply(this,arguments)}}()});return c}));return function(t){return e.apply(this,arguments)}}(),o.createAccount=function(){var e=(0,i.default)((function*(e){var t,n,o=e.indexes,i=e.purpose,a=e.names,u=e.template,s=e.addressIndex,c=e.isChange,d=e.isCustomAddress,v=e.confirmOnDevice,m=e.validator,T=yield this.getNetworkImpl(),x=this.vault,A=x.getDefaultPurpose(),E=x.getCoinName(),k=x.getCoinType(),C=i||A,O=0!==o[0],P=[].concat((0,r.default)(O?[o[0]-1]:[]),(0,r.default)(o)),B=(0,I.getAccountDefaultByPurpose)(C,E).addressEncoding,D=(0,g.getAccountNameInfoByTemplate)(T,u).prefix,N=yield this.vault.getProvider();try{var S=yield this.getHardwareInfo(),F=S.connectId,R=S.deviceId,U=yield this.getWalletPassphraseState();yield this.getHardwareSDKInstance();var H=(0,y.slicePathTemplate)(u).pathPrefix;t=yield f.HardwareSDK.btcGetPublicKey(F,R,b({bundle:P.map((function(e){return{path:`${H}/${e}'`,coin:E.toLowerCase(),showOnOneKey:!!v&&e===P[P.length-1]}}))},U)),n=yield f.HardwareSDK.btcGetPublicKey(F,R,b({bundle:P.map((function(e){return{path:`${H}/${e}'/0/0`,coin:E.toLowerCase(),showOnOneKey:!1}}))},U))}catch(ee){throw console.error(ee),new h.OneKeyHardwareError(ee)}if(!t.success||!t.payload||!n.success||!n.payload)throw console.error(t.payload),(0,l.convertDeviceError)(t.payload);if(t.payload.length!==P.length)throw new h.OneKeyInternalError("Unable to get publick key.");for(var K=[],_=0,M=0,j=t.payload.length;M<j;M+=1){var V,L,$=t.payload[M],W=$.path,X=$.xpub,G=$.xpubSegwit,z=n.payload[M].node,q=`${c?"1":"0"}/${s}`,Y=N.xpubToAddresses(X,[q],B)[q],Q=d?((V={})[q]=Y,V):void 0,J=[p.COINTYPE_DOGE,p.COINTYPE_BCH].includes(k)?E:D,Z=(a||[])[_]||`${J} #${P[_]+1}`;if(!O||_>0)K.push({id:`${this.walletId}--${W}`,name:Z,type:w.AccountType.UTXO,path:W,coinType:k,pubKey:z.public_key,xpub:X,xpubSegwit:G||X,address:Y,addresses:(L={},L[q]=Y,L),customAddresses:Q,template:u});if(1===P.length)break;if(m){if(!(yield null==m?void 0:m({xpub:G||X,address:Y,addressEncoding:B})))break;_+=1,yield new Promise((function(e){return setTimeout(e,200)}))}else _+=1}return K}));return function(t){return e.apply(this,arguments)}}(),o.prepareAccountByAddressIndex=function(){var e=(0,i.default)((function*(e){var t,n=e.template,r=e.accountIndex,o=e.addressIndex,i=parseInt(null==(t=n.split("/"))?void 0:t[1],10);return this.createAccount({indexes:[r],purpose:i,template:n,addressIndex:o,isChange:!1,isCustomAddress:!0})}));return function(t){return e.apply(this,arguments)}}(),o.getAddress=function(){var e=(0,i.default)((function*(e){var t=this.vault.getCoinName(),n="";if(e.isTemplatePath)n=e.path;else{var r=yield this.getDbAccount({noCache:!0}),o=r.addresses,i=r.address,a=Object.keys(r.addresses).find((function(e){return o[e]===i}));if(!a)return"";n=`${r.path}/${a}`}yield this.getHardwareSDKInstance();var u=yield this.getHardwareInfo(),s=u.connectId,c=u.deviceId,d=yield this.getWalletPassphraseState(),p=yield f.HardwareSDK.btcGetAddress(s,c,b({path:n,showOnOneKey:e.showOnOneKey,coin:t.toLowerCase()},d));if(p.success)return p.payload.address;throw(0,l.convertDeviceError)(p.payload)}));return function(t){return e.apply(this,arguments)}}(),o.batchGetAddress=function(){var e=(0,i.default)((function*(e){var t=this.vault.getCoinName(),n=yield this.getHardwareInfo(),r=n.connectId,o=n.deviceId,i=yield this.getWalletPassphraseState(),a=yield f.HardwareSDK.btcGetAddress(r,o,b(b({},i),{},{bundle:e.map((function(e){return{path:e.path,showOnOneKey:!!e.showOnOneKey,coin:t.toLowerCase()}}))}));if(!a.success)throw(0,l.convertDeviceError)(a.payload);return a.payload.map((function(e){var t,n;return{path:null!=(t=e.path)?t:"",address:null!=(n=e.address)?n:""}}))}));return function(t){return e.apply(this,arguments)}}(),o.signMessage=function(){var e=(0,i.default)((function*(e){v.default.common.info("BTCFork signMessage",e);var t=this.vault.getCoinName(),n=yield this.getDbAccount(),r=yield this.getHardwareInfo(),o=r.connectId,a=r.deviceId,u=yield this.getWalletPassphraseState();yield this.getHardwareSDKInstance();var s=yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){var r,i=yield f.HardwareSDK.btcSignMessage(o,a,b(b({},u),{},{path:`${n.path}/0/0`,coin:t,messageHex:T.from(e.message).toString("hex"),noScriptType:null==(r=e.sigOptions)?void 0:r.noScriptType}));if(!i.success)throw(0,l.convertDeviceError)(i.payload);return i.payload}));return function(t){return e.apply(this,arguments)}}()));return s.map((function(e){return e.signature}))}));return function(t){return e.apply(this,arguments)}}(),(0,a.default)(n)}(m.KeyringHardwareBase)},111365:(e,t,n)=>{n.r(t),n.d(t,{KeyringHd:()=>C});var r=n(968079),o=n(196234),i=n(634795),a=n(887371),u=n(545754),s=n(411987),c=n(695058),d=n(376314),l=n(344075),f=n.n(l),p=n(605851),v=n(613549),h=n(292147),y=n(471453),g=n(940915),w=n(997293),m=n(278489),I=n(794292),T=n(398145),x=n(572801),b=n(810887),A=n(16280),E=n(348834).Buffer;function k(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,c.default)(e);if(t){var o=(0,c.default)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,s.default)(this,n)}}var C=function(e){(0,u.default)(n,e);var t=k(n);function n(){return t.apply(this,arguments)}var s=n.prototype;return s.signTransaction=function(){var e=(0,i.default)((function*(e,t){(0,A.initBitcoinEcc)();var n=t.password,r=e.psbtHex,o=e.inputsToSign;if("undefined"===typeof n)throw new g.OneKeyInternalError("Software signing requires a password.");var i=yield this.getSigners(n,(o||e.inputs).map((function(e){return e.address})));h.default.engine.info("signTransaction",this.networkId,e);var a=yield this.vault.getProvider();if(r&&o){var u=a.network,s=d.Psbt.fromHex(r,{network:u});return a.signPsbt({psbt:s,signers:i,inputsToSign:o})}return a.signTransaction(e,i)}));return function(t,n){return e.apply(this,arguments)}}(),s.getSigners=function(){var e=(0,i.default)((function*(e,t){var n={},r=(yield this.vault.collectUTXOsInfo({checkInscription:!1})).utxos;for(var i of r){var a=i.address,u=i.path;t.includes(a)&&(n[u]=a)}var s=Object.keys(n).map((function(e){return e.split("/").slice(-2).join("/")}));if(0===s.length)throw new g.OneKeyInternalError("No signers would be chosen.");var c=yield this.getPrivateKeys(e,s),d={};for(var l of Object.entries(c)){var f=(0,o.default)(l,2),p=f[0],h=f[1],y=n[p];if((yield this.getNetworkImpl())===v.IMPL_TBTC){if(!y)y=n[p.replace("m/86'/0'/","m/86'/1'/")];if(!y)y=n[p.replace("m/86'/1'/","m/86'/0'/")]}var w=new I.Signer(h,e,"secp256k1");if(y!==y)throw new Error("addressFromPrivateKey and utxoAddress not matched");d[y]=w}return d}));return function(t,n){return e.apply(this,arguments)}}(),s.prepareAccounts=function(){var e=(0,i.default)((function*(e){var t=e.password,n=e.indexes,r=e.purpose,o=e.names,a=e.template,u=e.skipCheckAccountExist;(0,A.initBitcoinEcc)();var s=yield this.vault.getProvider(),c=yield this.createAccount({password:t,indexes:n,purpose:r,names:o,template:a,addressIndex:0,isChange:!1,isCustomAddress:!1,validator:u?void 0:function(){var e=(0,i.default)((function*(e){var t=e.xpub,n=e.addressEncoding;return(yield s.getAccount({type:"simple",xpub:t},n)).txs>0}));return function(t){return e.apply(this,arguments)}}()});return c}));return function(t){return e.apply(this,arguments)}}(),s.createAccount=function(){var e=(0,i.default)((function*(e){var t=e.password,n=e.indexes,o=e.purpose,i=e.names,a=e.template,u=e.addressIndex,s=e.isChange,c=e.isCustomAddress,d=e.validator,l=yield this.getNetworkImpl(),h=this.vault,y=h.getDefaultPurpose(),I=h.getCoinName(),x=h.getCoinType(),b=o||y,k=0!==n[0],C=[].concat((0,r.default)(k?[n[0]-1]:[]),(0,r.default)(n)),O=(0,A.getAccountDefaultByPurpose)(b,I).addressEncoding,P=(0,m.getAccountNameInfoByTemplate)(l,a).prefix,B=(yield this.engine.dbApi.getCredential(this.walletId,t)).seed,D=yield this.vault.getProvider(),N=D.network,S=(0,w.slicePathTemplate)(a).pathPrefix,F=(0,p.batchGetPublicKeys)("secp256k1",B,t,S,C.map((function(e){return`${e.toString()}'`})));if(F.length!==C.length)throw new g.OneKeyInternalError("Unable to get publick key.");var R=((N.segwitVersionBytes||{})[O]||N.bip32).public,U=[],H=0;for(var K of F){var _,M,j=K.path,V=K.parentFingerPrint,L=K.extendedKey,$=f().encode(E.concat([E.from(R.toString(16).padStart(8,"0"),"hex"),E.from([3]),V,E.from((C[H]+2**31).toString(16).padStart(8,"0"),"hex"),L.chainCode,L.key])),W=`${s?"1":"0"}/${u}`,X=D.xpubToAddresses($,[W],O)[W],G=c?((_={})[W]=X,_):void 0,z=[v.COINTYPE_DOGE,v.COINTYPE_BCH].includes(x)?I:P,q=(i||[])[H]||`${z} #${C[H]+1}`;if(!k||H>0)U.push({id:`${this.walletId}--${j}`,name:q,type:T.AccountType.UTXO,path:j,coinType:x,xpub:$,address:X,addresses:(M={},M[W]=X,M),customAddresses:G,template:a});if(1===C.length)break;if(d){if(!(yield null==d?void 0:d({xpub:$,address:X,addressEncoding:O})))break;H+=1,yield new Promise((function(e){return setTimeout(e,200)}))}else H+=1}return U}));return function(t){return e.apply(this,arguments)}}(),s.prepareAccountByAddressIndex=function(){var e=(0,i.default)((function*(e){var t,n=e.password,r=e.template,o=e.accountIndex,i=e.addressIndex,a=parseInt(null==(t=r.split("/"))?void 0:t[1],10);return yield this.createAccount({password:n,indexes:[o],purpose:a,template:r,addressIndex:i,isChange:!1,isCustomAddress:!0})}));return function(t){return e.apply(this,arguments)}}(),s.signMessage=function(){var e=(0,i.default)((function*(e,t){h.default.common.info("BTCFork signMessage",e);for(var n=t.password,r=void 0===n?"":n,o=(yield this.engine.dbApi.getCredential(this.walletId,r)).entropy,i=yield this.engine.getAccount(this.accountId,this.networkId),a=yield this.getNetwork(),u=`${i.path}/0/0`,s=yield this.vault.getProvider(),c=[],d=0,l=e.length;d<l;d+=1){var f=e[d],p=f.message,v=f.type,g=f.sigOptions;if(v===x.BtcMessageTypes.BIP322_SIMPLE){var w=yield this.getSigners(r,[i.address]),m=yield s.signBip322MessageSimple({account:i,message:p,signers:w,psbtNetwork:(0,y.toPsbtNetwork)(a)});c.push(m)}else{var I=s.signMessage({password:r,entropy:o,path:u,message:p,sigOptions:g});c.push(I)}}return c.map((function(e){return e.toString("hex")}))}));return function(t,n){return e.apply(this,arguments)}}(),(0,a.default)(n)}(b.KeyringHdBase)},602219:(e,t,n)=>{n.r(t),n.d(t,{KeyringImported:()=>A});var r=n(968079),o=n(196234),i=n(634795),a=n(887371),u=n(545754),s=n(411987),c=n(695058),d=n(344075),l=n.n(d),f=n(672758),p=n(478557),v=n(901187),h=n(292147),y=n(940915),g=n(794292),w=n(398145),m=n(255942),I=n(16280),T=n(348834).Buffer;function x(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,c.default)(e);if(t){var o=(0,c.default)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,s.default)(this,n)}}var b=new f.BaseBip32KeyDeriver(T.from("Bitcoin seed"),p.secp256k1),A=function(e){(0,u.default)(n,e);var t=x(n);function n(){return t.apply(this,arguments)}var s=n.prototype;return s.signTransaction=function(){var e=(0,i.default)((function*(e,t){(0,I.initBitcoinEcc)();var n=t.password;if("undefined"===typeof n)throw new y.OneKeyInternalError("Software signing requires a password.");var r=yield this.getSigners(n,e.inputs.map((function(e){return e.address})));return h.default.engine.info("signTransaction",this.networkId,e),(yield this.vault.getProvider()).signTransaction(e,r)}));return function(t,n){return e.apply(this,arguments)}}(),s.getSigners=function(){var e=(0,i.default)((function*(e,t){var n={},r=(yield this.vault.collectUTXOsInfo({checkInscription:!1})).utxos;for(var i of r){var a=i.address,u=i.path;if(t.includes(a)){var s=u.split("/").slice(-2).join("/");n[s]=a}}var c=Object.keys(n);if(0===c.length)throw new y.OneKeyInternalError("No signers would be chosen.");var d={},l={},f=Object.values(yield this.getPrivateKeys(e)),p=(0,o.default)(f,1)[0],h=(0,v.decrypt)(e,p),w={chainCode:h.slice(13,45),key:h.slice(46,78)};return c.forEach((function(t){var r=t.split("/"),o="",i=w;r.forEach((function(e){if(o=o.length>0?`${o}/${e}`:e,"undefined"===typeof l[o]){var t=e.endsWith("'")?parseInt(e.slice(0,-1))+2**31:parseInt(e),n=b.CKDPriv(i,t);l[o]=n}i=l[o]}));var a=n[t];d[a]=new g.Signer((0,v.encrypt)(e,l[t].key),e,"secp256k1")})),d}));return function(t,n){return e.apply(this,arguments)}}(),s.prepareAccounts=function(){var e=(0,i.default)((function*(e){var t;(0,I.initBitcoinEcc)();var n=e.privateKey,o=e.name,i=yield this.vault.getProvider(),a=this.vault.getCoinType(),u="",s=i.network,c=parseInt(n.slice(0,4).toString("hex"),16);for(var d of[].concat((0,r.default)(Object.values(s.segwitVersionBytes||{})),[s.bip32]))if(d.private===c){var f=p.secp256k1.publicFromPrivate(n.slice(46,78)),v=T.from(d.public.toString(16).padStart(8,"0"),"hex");try{u=l().encode(n.fill(v,0,4).fill(f,45,78))}catch(m){console.error(m)}}if(""===u)throw new y.OneKeyInternalError("Invalid private key.");var h="0/0",g=i.xpubToAddresses(u,[h])[h];return Promise.resolve([{id:`imported--${a}--${u}`,name:o||"",type:w.AccountType.UTXO,path:"",coinType:a,xpub:u,address:g,addresses:(t={},t[h]=g,t)}])}));return function(t){return e.apply(this,arguments)}}(),(0,a.default)(n)}(m.KeyringImportedBase)},520173:(e,t,n)=>{n.r(t),n.d(t,{KeyringWatching:()=>l});var r=n(634795),o=n(887371),i=n(545754),a=n(411987),u=n(695058),s=n(940915),c=n(398145);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.default)(e);if(t){var o=(0,u.default)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,a.default)(this,n)}}var l=function(e){(0,i.default)(n,e);var t=d(n);function n(){return t.apply(this,arguments)}return n.prototype.prepareAccounts=function(){var e=(0,r.default)((function*(e){var t;console.log("btcfork watching prepareAccount");var n=e.target,r=e.name,o=e.accountIdPrefix,i=yield this.vault.getProvider(),a=this.vault.getCoinType();try{if(!i.isValidXpub(n))throw new s.InvalidAddress}catch(l){throw new s.InvalidAddress}var u="0/0",d=i.xpubToAddresses(n,[u])[u];return[{id:`${o}--${a}--${n}`,name:r||"",type:c.AccountType.UTXO,path:"",coinType:a,xpub:n,address:d,addresses:(t={},t[u]=d,t)}]}));return function(t){return e.apply(this,arguments)}}(),(0,o.default)(n)}(n(701625).KeyringWatchingBase)},690350:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Y});var r=n(968079),o=n(459740),i=n(301842),a=n.n(i),u=n(256666),s=n(196234),c=n(161049),d=n.n(c),l=n(634795),f=n(887371),p=n(545754),v=n(411987),h=n(695058),y=n(206391),g=n.n(y),w=n(344075),m=n.n(w),I=n(636393),T=n(992431),x=n(901187),b=n(380845),A=n(402814),E=n(613549),k=n(292147),C=n(471453),O=n(396564),P=n(313503),B=n(732349),D=n(940915),N=n(997293),S=n(278489),F=n(790656),R=n(556658),U=n(63450),H=n(459729),K=n(631368),_=n(398514),M=n(786141),j=n(392853),V=n(882914),L=n(331489),$=n(16280),W=n(348834).Buffer,X=["txId","value"];function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach((function(t){(0,u.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function q(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,h.default)(e);if(t){var o=(0,h.default)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,v.default)(this,n)}}var Y=function(e){(0,p.default)(n,e);var t=q(n);function n(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).keyringMap={},e.settings={},e.providerClass=V.Provider,e.collectUTXOsInfo=(0,O.memoizee)((0,l.default)((function*(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=yield e.getProvider(),r=yield e.getDbAccount();try{var o=yield n.getUTXOs(e.getAccountXpub(r),t);if("ERROR"===o.ordQueryStatus&&d()(n.getUTXOs.clear))try{n.getUTXOs.clear()}catch(i){}return o}catch(a){throw console.error(a),new D.OneKeyInternalError("Failed to get UTXOs of the account.")}})),{promise:!0,max:4,maxAge:3e4}),e.getFeeRate=(0,O.memoizee)((0,l.default)((function*(){var t=yield(yield e.getProvider()).blockbook,n=e.getDefaultBlockNums();try{for(var r=yield Promise.all(n.map((function(e){return t.estimateFee(e).then((function(e){return new(g())(e).toFixed(0)}))}))),o=r.findIndex((function(e){return new(g())(e).lt(0)}));o>=0;){for(var i=o-1,a=o+1;;){if(i>=0&&new(g())(r[i]).gte(0)){r[o]=r[i];break}if(a<r.length&&new(g())(r[a]).gte(0)){r[o]=r[a];break}if(a+=1,(i-=1)<0&&a>=r.length)break}o=r.findIndex((function(e){return new(g())(e).lt(0)}))}return r.sort((function(e,t){return new(g())(e).comparedTo(new(g())(t))}))}catch(u){throw console.error(u),new D.OneKeyInternalError("Failed to get fee rates.")}})),{promise:!0,max:1,maxAge:3e4}),e}var i=n.prototype;return i.getDefaultPurpose=function(){return(0,N.getDefaultPurpose)(E.IMPL_BTC)},i.getCoinName=function(){return"BTC"},i.getCoinType=function(){return E.COINTYPE_BTC},i.getXprvReg=function(){return/^[xyz]prv/},i.getXpubReg=function(){return/^[xyz]pub/},i.getDefaultBlockNums=function(){return[5,2,1]},i.getDefaultBlockTime=function(){return 600},i.getAccountXpub=function(e){return e.xpub},i.getProvider=function(){var e=(0,l.default)((function*(){var e,t,n=yield this.getRpcUrl(),r="";null!=(e=this.provider)&&e.chainInfo&&(r=(0,L.getRpcUrlFromChainInfo)(null==(t=this.provider)?void 0:t.chainInfo));if(!this.provider||r!==n){var o=yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId),i=this.providerClass;this.provider=new i(o)}return this.provider}));return function(){return e.apply(this,arguments)}}(),i.getOutputAccount=function(){var e=(0,l.default)((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,pubKey:e.pubKey,xpub:this.getAccountXpub(e),template:e.template,customAddresses:JSON.stringify(e.customAddresses)}}));return function(){return e.apply(this,arguments)}}(),i.getFetchBalanceAddress=function(e){return Promise.resolve(this.getAccountXpub(e))},i.validateAddress=function(){var e=(0,l.default)((function*(e){var t=(yield this.getProvider()).verifyAddress(e),n=t.normalizedAddress;if(!t.isValid||"undefined"===typeof n)throw new D.InvalidAddress;return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),i.validateTokenAddress=function(){var e=(0,l.default)((function*(e){return(0,P.isBRC20Token)(e)?Promise.resolve(e):Promise.reject(new D.InvalidTokenAddress)}));return function(t){return e.apply(this,arguments)}}(),i.validateImportedCredential=function(){var e=(0,l.default)((function*(e){var t=this.getXprvReg(),n=!1;try{n=this.settings.importedAccountEnabled&&t.test(e)&&(yield this.getProvider()).isValidXprv(e)}catch(r){}return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),i.validateWatchingCredential=function(){var e=(0,l.default)((function*(e){if(!e)return Promise.resolve(!1);var t=this.getXpubReg(),n=!1;try{n=this.settings.watchingAccountEnabled&&t.test(e)&&(yield this.getProvider()).isValidXpub(e)}catch(r){}if(!n){console.error(`BTCfork validateWatchingCredential ERROR: not valid xpub:${e}`);try{n=Boolean(yield this.validateAddress(e))}catch(o){n=!1,console.error(`BTCfork validateWatchingCredential ERROR: not valid address:${e}`)}}return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),i.validateCanCreateNextAccount=function(){var e=(0,l.default)((function*(e,t){var n=yield Promise.all([this.engine.getWallet(e),this.engine.getNetwork(this.networkId)]),r=(0,s.default)(n,2),o=r[0],i=r[1],a=(0,N.getLastAccountId)(o,i.impl,t);if(!a)return!0;var u=yield this.engine.dbApi.getAccounts([a]),c=(0,s.default)(u,1)[0];if("undefined"!==typeof c&&!(yield this.checkAccountExistence(this.getAccountXpub(c)))){var d=(0,S.getAccountNameInfoByTemplate)(i.impl,t).label;throw new D.PreviousAccountIsEmpty(d)}return!0}));return function(t,n){return e.apply(this,arguments)}}(),i.checkAccountExistence=function(){var e=(0,l.default)((function*(e,t){var n=!1,r=0;try{var o=yield this.getProvider();if(t)r=(yield o.getAccountWithAddress({type:"simple",address:e})).txs;else r=(yield o.getAccount({type:"simple",xpub:e})).txs;n=r>0}catch(i){console.error(i)}return Promise.resolve(n)}));return function(t,n){return e.apply(this,arguments)}}(),i.getAccountBalance=function(){var e=(0,l.default)((function*(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.map((function(e){}));if(!t)return n;var r,o=yield this.getDbAccount(),i=this.getAccountXpub(o);if(i){var a=yield this.getBalances([{address:i}]);r=(0,s.default)(a,1)[0]}else if(o.address){var u=yield this.getBalancesByAddress([{address:o.address}]);r=(0,s.default)(u,1)[0]}return[r].concat(n)}));return function(t){return e.apply(this,arguments)}}(),i.getBalances=function(){var e=(0,l.default)((function*(e){return(yield this.getProvider()).getBalances(e)}));return function(t){return e.apply(this,arguments)}}(),i.getBalancesByAddress=function(){var e=(0,l.default)((function*(e){return(yield this.getProvider()).getBalancesByAddress(e)}));return function(t){return e.apply(this,arguments)}}(),i.getExportedCredential=function(){var e=(0,l.default)((function*(e){var t=yield this.getDbAccount();if(t.id.startsWith("hd-")){var n=parseInt(t.path.split("/")[1]),r=(0,$.getAccountDefaultByPurpose)(n,this.getCoinName()).addressEncoding,o=(yield this.getProvider()).network,i=((o.segwitVersionBytes||{})[r]||o.bip32).private,a=this.keyring,u=Object.values(yield a.getPrivateKeys(e)),c=(0,s.default)(u,1)[0];return m().encode(m().decode(t.xpub).fill(W.from(i.toString(16).padStart(8,"0"),"hex"),0,4).fill(W.concat([W.from([0]),(0,x.decrypt)(e,c)]),45,78))}if(t.id.startsWith("imported-")){var d=(yield this.engine.dbApi.getCredential(this.accountId,e)).privateKey;if("undefined"===typeof d)throw new D.OneKeyInternalError("Unable to get credential.");return m().encode((0,x.decrypt)(e,d))}throw new D.OneKeyInternalError("Only credential of HD or imported accounts can be exported")}));return function(t){return e.apply(this,arguments)}}(),i.attachFeeInfoToEncodedTx=function(){var e=(0,l.default)((function*(e){var t=yield this.engine.getNetwork(this.networkId),n=e.encodedTx,r=e.feeInfoValue,o=r.feeRate?new(g())(r.feeRate).shiftedBy(-t.feeDecimals).toFixed():r.price;return"string"===typeof o?n.transferInfos?this.buildEncodedTxFromBatchTransfer({transferInfos:n.transferInfos,specifiedFeeRate:o}):this.buildEncodedTxFromTransfer(n.transferInfo,o):Promise.resolve(e.encodedTx)}));return function(t){return e.apply(this,arguments)}}(),i.decodedTxToLegacy=function(e){var t=e.actions[0],n=t.type,r=t.nativeTransfer;t.inscriptionInfo;return n===_.IDecodedTxActionType.NATIVE_TRANSFER&&r?Promise.resolve({txType:K.EVMDecodedTxType.NATIVE_TRANSFER,symbol:"UNKNOWN",amount:r.amount,value:r.amountValue,fromAddress:r.from,toAddress:r.to,data:"",totalFeeInNative:e.totalFeeInNative,total:g().sum.apply(null,(r.utxoFrom||[]).map((function(e){return e.balanceValue}))).toFixed()}):Promise.resolve({})},i.decodePsbt=function(){var e=(0,l.default)((function*(e,t){for(var n=e.inputs,r=e.outputs,o=e.totalFee,i=new(g())(o).isNegative()||new(g())(o).isNaN(),a=yield this.engine.getNativeTokenInfo(this.networkId),u=yield this.getDbAccount(),s=yield this.getNetwork(),c=[],d=new(g())("0"),l=0,f=n.length;l<f;l+=1){var p,v=n[l];if(v.address===u.address)null!=(p=v.inscriptions)&&p[0]?c.push(yield this.buildInscriptionAction({from:u.address,to:"unknown",amount:"0",asset:z(z({},v.inscriptions[0]),{},{type:R.NFTAssetType.BTC})})):d=d.minus(v.value)}for(var h=0,y=r.length;h<y;h+=1){var w,m=r[h];if(m.address===u.address)i?c.push({type:_.IDecodedTxActionType.NATIVE_TRANSFER,direction:_.IDecodedTxDirection.IN,nativeTransfer:{tokenInfo:a,from:"unknown",to:u.address,amount:new(g())(m.value).shiftedBy(-s.decimals).toFixed(),amountValue:m.value,extraInfo:null}}):null!=(w=m.inscriptions)&&w[0]?c.push(yield this.buildInscriptionAction({from:"unknown",to:u.address,amount:"0",asset:z(z({},m.inscriptions[0]),{},{type:R.NFTAssetType.BTC})})):d=d.plus(m.value)}if(!d.isZero()){var T=d.isGreaterThan(0);c.push({type:_.IDecodedTxActionType.NATIVE_TRANSFER,direction:T?_.IDecodedTxDirection.IN:_.IDecodedTxDirection.OUT,nativeTransfer:{tokenInfo:a,from:T?"unknown":u.address,to:T?u.address:"unknown",amount:d.abs().shiftedBy(-s.decimals).toFixed(),amountValue:d.abs().toFixed(),extraInfo:null}})}return{txid:i?I.default.v4().toString():"",owner:u.address,signer:u.address,nonce:0,actions:c,status:i?_.IDecodedTxStatus.Offline:_.IDecodedTxStatus.Pending,networkId:this.networkId,accountId:this.accountId,extraInfo:null,totalFeeInNative:e.totalFeeInNative}}));return function(t,n){return e.apply(this,arguments)}}(),i.decodeTx=function(){var e=(0,l.default)((function*(e,t){var n,r,o,i=e.inputs,a=e.outputs,u=e.psbtHex,s=e.inputsToSign,c=null!=(n=e.transferInfo)?n:null==(r=e.transferInfos)?void 0:r[0],d=yield this.engine.getNetwork(this.networkId),l=yield this.getDbAccount(),f=yield this.engine.getNativeTokenInfo(this.networkId),p=(null!=(o=null==t?void 0:t.nftInfos)?o:[null==t?void 0:t.nftInfo]).filter(Boolean),v=c.isNFT?i.filter((function(e){return e.forceSelect})):null,h=[];if(u&&s)return this.decodePsbt(e,t);if(v&&v.length>0&&p.length>0)for(var y=0,w=p.length;y<w;y+=1){var m=p[y];h.push(yield this.buildInscriptionAction(m))}else{var I=i.map((function(e){return{address:e.address,balance:new(g())(e.value).shiftedBy(-d.decimals).toFixed(),balanceValue:e.value,symbol:d.symbol,isMine:!0}})),T=a.filter((function(e){var t;return!(null!=(t=e.payload)&&t.isCharge)})).map((function(e){return{address:e.address,balance:new(g())(e.value).shiftedBy(-d.decimals).toFixed(),balanceValue:e.value,symbol:d.symbol,isMine:e.address===l.address}}));h=T.map((function(e){return{type:_.IDecodedTxActionType.NATIVE_TRANSFER,direction:a[0].address===l.address?_.IDecodedTxDirection.OUT:_.IDecodedTxDirection.SELF,utxoFrom:I,utxoTo:T,nativeTransfer:{tokenInfo:f,from:l.address,to:e.address,amount:e.balance,amountValue:e.balanceValue,extraInfo:null}}}))}return{txid:"",owner:l.address,signer:l.address,nonce:0,actions:h,status:_.IDecodedTxStatus.Pending,networkId:this.networkId,accountId:this.accountId,extraInfo:null,totalFeeInNative:e.totalFeeInNative}}));return function(t,n){return e.apply(this,arguments)}}(),i.buildBRC20TokenAction=function(e){var t=e.nftInfo,n=e.token,r=e.dbAccount,o=e.brc20Content,i=t.from,a=t.to,u=_.IDecodedTxActionType.UNKNOWN,s=_.IDecodedTxDirection.OTHER,c={};return(null==o?void 0:o.op)===U.BRC20TokenOperation.Deploy&&(u=_.IDecodedTxActionType.TOKEN_BRC20_DEPLOY,s=_.IDecodedTxDirection.OUT,c={limit:o.lim,max:o.max}),(null==o?void 0:o.op)===U.BRC20TokenOperation.Mint&&(u=_.IDecodedTxActionType.TOKEN_BRC20_MINT,s=_.IDecodedTxDirection.IN,c={amount:o.amt}),(null==o?void 0:o.op)===U.BRC20TokenOperation.Transfer&&(u=_.IDecodedTxActionType.TOKEN_BRC20_TRANSFER,c={amount:o.amt},i===a&&i===r.address?s=_.IDecodedTxDirection.SELF:i===r.address?s=_.IDecodedTxDirection.OUT:a===r.address&&(s=_.IDecodedTxDirection.IN)),(null==o?void 0:o.op)===U.BRC20TokenOperation.InscribeTransfer&&(u=_.IDecodedTxActionType.TOKEN_BRC20_INSCRIBE,s=_.IDecodedTxDirection.IN,c={amount:o.amt}),o?{type:u,direction:s,brc20Info:z({token:n,asset:t.asset,sender:t.from,receiver:t.to,extraInfo:null},c)}:{type:u,direction:s}},i.buildNFTAction=function(e){var t=e.nftInfo,n=e.dbAccount,r=t.from,o=t.to,i=_.IDecodedTxDirection.OTHER;return r===o&&r===n.address?i=_.IDecodedTxDirection.SELF:r===n.address?i=_.IDecodedTxDirection.OUT:o===n.address&&(i=_.IDecodedTxDirection.IN),{type:_.IDecodedTxActionType.NFT_TRANSFER_BTC,direction:i,inscriptionInfo:{send:t.from,receive:null==t?void 0:t.to,asset:null==t?void 0:t.asset,extraInfo:null}}},i.buildInscriptionAction=function(){var e=(0,l.default)((function*(e){var t,n=e.asset,r=n.content,o=n.content_type,i=n.contentUrl,a=yield this.getDbAccount(),u=yield(0,P.parseBRC20Content)({content:r,contentType:o,contentUrl:i}),s=u.isBRC20Content,c=u.brc20Content,d=`brc-20--${null!=(t=null==c?void 0:c.tick)?t:""}`,l=yield this.engine.findToken({networkId:this.networkId,tokenIdOnNetwork:d});return s&&l?this.buildBRC20TokenAction({nftInfo:e,dbAccount:a,token:l,brc20Content:c}):this.buildNFTAction({nftInfo:e,dbAccount:a})}));return function(t){return e.apply(this,arguments)}}(),i.buildEncodedTxFromTransfer=function(){var e=(0,l.default)((function*(e,t){if(!e.to)throw new Error("Invalid transferInfo.to params");return this.buildEncodedTxFromBatchTransfer({transferInfos:[e],specifiedFeeRate:t})}));return function(t,n){return e.apply(this,arguments)}}(),i.buildEncodedTxFromBatchTransfer=function(){var e=(0,l.default)((function*(e){var t=e.transferInfos,n=e.specifiedFeeRate,r=t[0],i=yield this.engine.getNetwork(this.networkId),u=yield this.getDbAccount(),s=yield this.buildTransferParamsWithCoinSelector({transferInfos:t,specifiedFeeRate:n}),c=s.inputs,d=s.outputs,l=s.fee,f=s.inputsForCoinSelect,p=s.outputsForCoinSelect,v=s.feeRate;if(!c||!d||a()(l))throw new D.InsufficientBalance("Failed to select UTXOs");var h=l.toString(),y=new(g())(h).shiftedBy(-1*i.feeDecimals).toFixed();return{inputs:c.map((function(e){var t=e.txId,n=e.value;return z(z({address:"",path:""},(0,o.default)(e,X)),{},{txid:t,value:n.toString()})})),outputs:d.map((function(e){var t=e.value,n=e.address,r=n||u.address;if(!r)throw new Error("buildEncodedTxFromBatchTransfer ERROR: Invalid change address");var o=null==t?void 0:t.toString();if(!o||new(g())(o).lte(0))throw new Error("buildEncodedTxFromBatchTransfer ERROR: Invalid value");return{address:r,value:o,payload:n?void 0:{isCharge:!0,bip44Path:(0,$.getBIP44Path)(u,u.address)}}})),totalFee:h,totalFeeInNative:y,transferInfo:r,transferInfos:t,feeRate:v,inputsForCoinSelect:f,outputsForCoinSelect:p}}));return function(t){return e.apply(this,arguments)}}(),i.buildEncodedTxFromApprove=function(e){throw new D.NotImplemented},i.updateEncodedTxTokenApprove=function(e,t){throw new D.NotImplemented},i.updateEncodedTx=function(){var e=(0,l.default)((function*(e,t,n){if(n.type===_.IEncodedTxUpdateType.advancedSettings&&Array.isArray(t.selectedUtxos)&&t.selectedUtxos.length){var r=yield this.engine.getNetwork(this.networkId);return this.buildEncodedTxFromTransfer(z(z({},e.transferInfo),{},{selectedUtxos:t.selectedUtxos}),new(g())(e.feeRate).shiftedBy(-r.feeDecimals).toFixed())}return Promise.resolve(e)}));return function(t,n,r){return e.apply(this,arguments)}}(),i.buildUnsignedTxFromEncodedTx=function(e){var t=e.inputs,n=e.outputs,r=e.psbtHex,o=e.inputsToSign,i=[];for(var a of t){var u=new(g())(a.value);i.push({address:a.address,value:u,utxo:{txid:a.txid,vout:a.vout,value:u}})}var s=n.map((function(e){var t=e.address,n=e.value,r=e.payload;return{address:t,value:new(g())(n),payload:r}})),c={inputs:i,outputs:s,psbtHex:r,inputsToSign:o,payload:{},encodedTx:e};return Promise.resolve(c)},i.fetchFeeInfo=function(){var e=(0,l.default)((function*(e,t,n){var r=yield this.engine.getNetwork(this.networkId),o=yield this.getProvider(),i=(yield o.buildUnsignedTx(z(z({},yield this.buildUnsignedTxFromEncodedTx(e)),{},{feePricePerUnit:new(g())(1),encodedTx:e}))).feeLimit,a=(n?[n]:yield this.getFeeRate()).map((function(e){return new(g())(e).shiftedBy(-r.feeDecimals).toFixed()})),u=a.map((function(t){return(0,$.coinSelect)({inputsForCoinSelect:e.inputsForCoinSelect,outputsForCoinSelect:e.outputsForCoinSelect,feeRate:new(g())(t).shiftedBy(r.feeDecimals).toFixed()}).fee})).filter(Boolean);return{isBtcForkChain:!0,limit:(null!=i?i:new(g())(0)).toFixed(),prices:a,feeList:u,waitingSeconds:yield this.getTxWaitingSeconds(),defaultPresetIndex:"1",feeSymbol:"BTC",feeDecimals:r.feeDecimals,nativeSymbol:r.symbol,nativeDecimals:r.decimals,tx:null}}));return function(t,n,r){return e.apply(this,arguments)}}(),i.getTxWaitingSeconds=function(){var e=(0,l.default)((function*(){var e=this;return this.getDefaultBlockNums().map((function(t){return t*e.getDefaultBlockTime()}))}));return function(){return e.apply(this,arguments)}}(),i.getFeePricePerUnit=function(){var e=(0,l.default)((function*(){var e=(yield this.getFeeRate()).map((function(e){return new(g())(e)}));return{normal:{price:e[1]},others:[{price:e[0]},{price:e[2]}]}}));return function(){return e.apply(this,arguments)}}(),i.broadcastTransaction=function(){var e=(0,l.default)((function*(e){var t,n=this;k.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var r=yield this.getProvider(),o=yield r.broadcastTransaction(e.rawTx);k.default.engine.info("broadcastTransaction END:",{txid:o,rawTx:e.rawTx});var i=(null!=(t=e.encodedTx)?t:{inputs:[]}).inputs.map((function(e){return(0,B.getUtxoId)(n.networkId,e)}));try{yield T.default.utxoAccounts.deleteCoinControlItem(i)}catch(a){}return z(z({},e),{},{txid:o})}));return function(t){return e.apply(this,arguments)}}(),i.getTransactionStatuses=function(){var e=(0,l.default)((function*(e){return(yield this.getProvider()).getTransactionStatuses(e)}));return function(t){return e.apply(this,arguments)}}(),i.buildActionsFromBTCTransaction=function(){var e=(0,l.default)((function*(e){var t=e.transaction,n=e.address,r=_.IDecodedTxActionType.UNKNOWN,o=t.send,i=t.receive,a=t.event_type,u=t.asset;if(!u)return[];var s=u.content_type,c=u.content,d=u.contentUrl,l=yield(0,P.parseBRC20Content)({content:c,contentType:s,contentUrl:d}),f=l.isBRC20Content,p=l.brc20Content;if(f){var v,h=yield this.getDbAccount(),y=yield this.engine.findToken({networkId:this.networkId,tokenIdOnNetwork:`brc-20--${null!=(v=null==p?void 0:p.tick)?v:""}`});if(y)return[this.buildBRC20TokenAction({nftInfo:{asset:u,amount:"0",from:o,to:i},token:y,dbAccount:h,brc20Content:p})]}var g={send:o,receive:i,asset:u,extraInfo:null};return"Transfer"===a?r=_.IDecodedTxActionType.NFT_TRANSFER_BTC:"Mint"===a&&(r=_.IDecodedTxActionType.NFT_INSCRIPTION),[{type:r,hidden:!(o===n||i===n),direction:o===n?_.IDecodedTxDirection.OUT:_.IDecodedTxDirection.IN,extraInfo:null,inscriptionInfo:g}]}));return function(t){return e.apply(this,arguments)}}(),i.mergeNFTTransaction=function(){var e=(0,l.default)((function*(e){var t,n=this,r=e.nftTxs,o=e.nativeActions,i=e.address,a=(yield Promise.all(null!=(t=null==r?void 0:r.map((function(e){return n.buildActionsFromBTCTransaction({transaction:e,address:i})})))?t:"")).flat().filter(Boolean);return(0,C.checkIsUnListOrderPsbt)(a,i)?[a[0],z(z({},a[1]),{},{direction:_.IDecodedTxDirection.IN})]:(null==a?void 0:a.length)>0?a:o}));return function(t){return e.apply(this,arguments)}}(),i.fetchOnChainHistory=function(){var e=(0,l.default)((function*(e){var t=this,n=e.localHistory,r=void 0===n?[]:n,o=e.tokenIdOnNetwork,i=yield this.getProvider(),a=yield this.getDbAccount(),u=yield this.engine.getNetwork(this.networkId),s=u.decimals,c=u.symbol,d=u.impl,f=yield this.engine.getNativeTokenInfo(this.networkId);if(o&&(0,P.isBRC20Token)(o)){var p=yield(0,F.getBRC20TransactionHistory)({networkId:this.networkId,address:a.address,tokenAddress:o}),v=new Set,h=p.map(function(){var e=(0,l.default)((function*(e){try{var n,o=r.find((function(t){return t.decodedTx.txid===e.txId}));if(o&&o.decodedTx.isFinal)return null;if(v.has(e.txId))return null;v.add(e.txId);for(var i=p.filter((function(t){return t.txId===e.txId})),u=[],s=0,c=i.length;s<c;s+=1){var d=i[s],l=d.fromAddress,f=d.toAddress,h=(d.time,d.token),y=d.actionType,w=d.amount,m=`brc-20--${h}`,I=yield t.engine.findToken({networkId:t.networkId,tokenIdOnNetwork:m}),T="inscribeTransfer"===y;if(I){var x=t.buildBRC20TokenAction({nftInfo:{from:T?f:l,to:f,amount:w,asset:{type:R.NFTAssetType.BTC,inscription_id:e.inscriptionId,inscription_number:new(g())(e.inscriptionNumber).toNumber(),tx_hash:e.txId,content:"",content_length:0,content_type:"",timestamp:e.time,output:e.index,owner:"",output_value_sat:0,genesis_transaction_hash:"",location:e.location,contentUrl:""}},dbAccount:a,token:I,brc20Content:{p:"brc20",op:y,tick:h,amt:w}});u.push(x)}}var b=i[0].time,A={txid:e.txId,owner:a.address,signer:a.address,nonce:0,actions:u,status:_.IDecodedTxStatus.Confirmed,networkId:t.networkId,accountId:t.accountId,extraInfo:null};return A.updatedAt="undefined"!==typeof b?new(g())(b).toNumber():Date.now(),A.createdAt=null!=(n=null==o?void 0:o.decodedTx.createdAt)?n:A.updatedAt,A.isFinal=A.status===_.IDecodedTxStatus.Confirmed,yield t.buildHistoryTx({decodedTx:A,historyTxToMerge:o})}catch(E){return console.error(E),Promise.resolve(null)}}));return function(t){return e.apply(this,arguments)}}());return(yield Promise.all(h)).filter(Boolean)}var y=[];try{var w;y=null!=(w=(yield i.getHistory({type:"history",xpub:this.getAccountXpub(a)},d,a.address,c,s)).transactions)?w:[]}catch(T){console.error(T)}var m={};try{m=yield(0,F.getNFTTransactionHistory)(a.address,this.networkId)}catch(T){console.error(T)}var I=y.map(function(){var e=(0,l.default)((function*(e){try{var n,o,i=r.find((function(t){return t.decodedTx.txid===e.txid})),u=e.direction,c=e.utxoFrom,d=e.utxoTo,l=e.from,p=e.to,v=e.amount,h=e.amountValue,y=null==d?void 0:d.filter((function(e){return!e.isMine})),w=y&&y.length?y.filter((function(e){return!e.isMine})).map((function(e){return{type:_.IDecodedTxActionType.NATIVE_TRANSFER,direction:u,nativeTransfer:{tokenInfo:f,utxoFrom:c,utxoTo:d,from:l,to:e.address,amount:e.balance,amountValue:e.balanceValue,extraInfo:null}}})):[{type:_.IDecodedTxActionType.NATIVE_TRANSFER,direction:u,nativeTransfer:{tokenInfo:f,utxoFrom:c,utxoTo:d,from:l,to:p,amount:v,amountValue:h,extraInfo:null}}],I=m[e.txid],x=yield t.mergeNFTTransaction({nftTxs:I,nativeActions:w,address:a.address}),b={txid:e.txid,owner:a.address,signer:a.address,nonce:0,actions:x,status:(null!=(n=e.confirmations)?n:0)>0?_.IDecodedTxStatus.Confirmed:_.IDecodedTxStatus.Pending,networkId:t.networkId,accountId:t.accountId,extraInfo:null,totalFeeInNative:new(g())(e.fees).shiftedBy(-s).toFixed()};return b.updatedAt="undefined"!==typeof e.blockTime?1e3*e.blockTime:Date.now(),b.createdAt=null!=(o=null==i?void 0:i.decodedTx.createdAt)?o:b.updatedAt,b.isFinal=b.status===_.IDecodedTxStatus.Confirmed,yield t.buildHistoryTx({decodedTx:b,historyTxToMerge:i})}catch(T){return console.error(T),Promise.resolve(null)}}));return function(t){return e.apply(this,arguments)}}());return(yield Promise.all(I)).filter(Boolean)}));return function(t){return e.apply(this,arguments)}}(),i.fixActionDirection=function(){var e=(0,l.default)((function*(e){var t,n,r=e.action,o=e.accountAddress;r.type!==_.IDecodedTxActionType.NATIVE_TRANSFER||r.direction||(r.direction=yield this.buildTxActionDirection({from:(null==(t=r.nativeTransfer)?void 0:t.from)||"",to:(null==(n=r.nativeTransfer)?void 0:n.to)||"",address:o}));return r}));return function(t){return e.apply(this,arguments)}}(),i.createClientFromURL=function(e){return new L.BlockBook(e)},i.fetchTokenInfos=function(){var e=(0,l.default)((function*(e){var t=yield(0,A.fetchData)("/token/meta/batch",{networkId:this.networkId,addresses:e},{},"POST");return Object.values(t)}));return function(t){return e.apply(this,arguments)}}(),i.getPrivateKeyByCredential=function(){var e=(0,l.default)((function*(e){var t=m().decode(e);return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),i.getAllUsedAddress=function(){var e=(0,l.default)((function*(){var e=yield this.getDbAccount(),t=this.getAccountXpub(e);if(!t)return[];var n=yield this.getProvider(),r=(yield n.getAccount({type:"usedAddress",xpub:t})).tokens;return(void 0===r?[]:r).filter((function(e){var t=e.path.split("/"),n=Number.isSafeInteger(+t[4])&&1===+t[4];return e.transfers>0&&!n})).map((function(e){return z(z({},e),{},{displayTotalReceived:new(g())(e.totalReceived).shiftedBy(-8).toFixed()})}))}));return function(){return e.apply(this,arguments)}}(),i.getAccountInfo=function(){var e=(0,l.default)((function*(e){var t=e.details,n=void 0===t?"txs":t,r=e.from,o=e.to,i=e.pageSize,a=yield this.getDbAccount(),u=this.getAccountXpub(a);return u?(yield this.getProvider()).getAccount({type:"accountInfo",xpub:u,details:n,from:r,to:o,pageSize:i}):[]}));return function(t){return e.apply(this,arguments)}}(),i.getFrozenUtxos=function(){var e=(0,l.default)((function*(e,t){var n,r=this,o=[];if(!(null==(n=(0,b.appSelector)((function(e){var t;return null==(t=e.settings.advancedSettings)?void 0:t.useDustUtxo})))||n)){var i,a=yield this.getNetwork(),u=new(g())((null!=(i=this.settings.dust)?i:this.settings.minTransferAmount)||0).shiftedBy(a.decimals);o=t.filter((function(e){return new(g())(e.value).isLessThanOrEqualTo(u)})).map((function(e){return z(z({},e),{},{id:(0,B.getUtxoId)(r.networkId,e),key:(0,B.getUtxoUniqueKey)(e)})}))}return(yield T.default.utxoAccounts.getCoinControlList(this.networkId,e)).filter((function(e){return e.frozen})).concat(o)}));return function(t,n){return e.apply(this,arguments)}}(),i.getRecycleInscriptionUtxos=function(){var e=(0,l.default)((function*(e){return(yield T.default.utxoAccounts.getCoinControlList(this.networkId,e)).filter((function(e){return e.recycle}))}));return function(t){return e.apply(this,arguments)}}(),i.buildTransferParamsWithCoinSelector=function(){var e=(0,l.default)((function*(e){var t=this,n=e.transferInfos,o=e.specifiedFeeRate;if(!n.length)throw new Error("buildTransferParamsWithCoinSelector ERROR: transferInfos is required");var i=n.length>1,a=Boolean(n.find((function(e){return e.isNFT||e.nftInscription}))),u=Boolean(n.find((function(e){return e.isBRC20}))),c=Boolean(n.find((function(e){return e.isInscribe}))),d=yield this.engine.getNetwork(this.networkId),l=yield this.getDbAccount(),f=[];if(a){if(i&&!u)throw new Error("BTC nft transfer is not supported in batch transfer");n.forEach((function(e){var t=e.nftInscription;if(!t)throw new Error("nftInscription is required for nft transfer");var n=t.output,r=t.address,o=n.split(":"),i=(0,s.default)(o,2),a=i[0],u=i[1];if(!a||!u||!r)throw new Error("invalid nftInscription output");var c=parseInt(u,10);if(Number.isNaN(c))throw new Error("invalid nftInscription output: vout");f.push({txId:a,vout:c,address:r})}))}else if(!c){(yield this.getRecycleInscriptionUtxos(l.xpub)).forEach((function(e){var t=e.key.split("_"),n=(0,s.default)(t,2),r=n[0],o=n[1];f.push({txId:r,vout:parseInt(o,10),address:l.address})}))}var p=(yield this.collectUTXOsInfo(f.length?{forceSelectUtxos:f}:void 0)).utxos,v="undefined"!==typeof o?new(g())(o).shiftedBy(d.feeDecimals).toFixed():(yield this.getFeeRate())[1],h=yield this.getFrozenUtxos(l.xpub,p),y=p.filter((function(e){return h.findIndex((function(n){return n.id===(0,B.getUtxoId)(t.networkId,e)}))<0}));p=y;var w=n.reduce((function(e,t){return Array.isArray(t.selectedUtxos)&&t.selectedUtxos.length&&e.push.apply(e,(0,r.default)(t.selectedUtxos)),e}),[]);Array.isArray(w)&&w.length&&(p=p.filter((function(e){return(null!=w?w:[]).includes((0,B.getUtxoUniqueKey)(e))})));var m=p.map((function(e){var t=e.txid,n=e.vout,r=e.value,o=e.address,i=e.path;return{txId:t,vout:n,value:parseInt(r),address:o,path:i}})),I=[];if(i){if(a&&!u)throw new Error("NFT Inscription transfer can only be single transfer");if(u){var T=this.validateInscriptionInputsForCoinSelect({inputsForCoinSelect:m,forceSelectUtxos:f}).values;I=n.map((function(e,t){return{address:e.to,value:T[t]}}))}else I=n.map((function(e){var t=e.to,n=e.amount;return{address:t,value:parseInt(new(g())(n).shiftedBy(d.decimals).toFixed())}}))}else{var x=n[0],b=x.to,A=x.amount,E=y.reduce((function(e,t){var n=t.value;return e.plus(n)}),new(g())("0")).shiftedBy(-d.decimals);if(E.lt(A))throw new D.InsufficientBalance;var k=E.lte(A),C=parseInt(new(g())(A).shiftedBy(d.decimals).toFixed());if(a){x.coinControlDisabled=!0,k=!1,C=H.INSCRIPTION_PADDING_SATS_VALUES.default;var O=this.validateInscriptionInputsForCoinSelect({inputsForCoinSelect:m,forceSelectUtxos:f}).values;C=(0,s.default)(O,1)[0]}I=[k?{address:b,isMax:!0}:{address:b,value:C}]}var P=i?void 0:n[0].coinSelectAlgorithm;if(!i&&I.length>1)throw new Error("single transfer should only have one output");var N=a?(0,$.coinSelectForOrdinal)({inputsForCoinSelect:m,outputsForCoinSelect:I,feeRate:v,isBRC20Transfer:u}):(0,$.coinSelect)({inputsForCoinSelect:m,outputsForCoinSelect:I,feeRate:v,algorithm:P});return{inputs:N.inputs,outputs:N.outputs,fee:N.fee,inputsForCoinSelect:m,outputsForCoinSelect:I,feeRate:v}}));return function(t){return e.apply(this,arguments)}}(),i.validateInscriptionInputsForCoinSelect=function(e){var t=e.inputsForCoinSelect,n=e.forceSelectUtxos,r=[],o=[],i=function(e){if(n.find((function(t){return t.address===e.address&&t.txId===e.txId&&t.vout===e.vout}))){if(e.value<0||a()(e.value))throw new Error("Sending inscription utxo value is not valid.");if(e.forceSelect=!0,o.push(e.value),r.push(e),1===n.length)return"break"}};for(var u of t){if("break"===i(u))break}if(0===r.length)throw new D.UtxoNotFoundError;return{foundedUtxos:r,values:o}},i.getFrozenBalance=function(){var e=(0,l.default)((function*(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).useRecycleBalance,t=yield this.fetchBalanceDetails({useRecycleBalance:e});if(t&&!a()(null==t?void 0:t.unavailable))return new(g())(t.unavailable).toNumber();throw new Error("getFrozenBalance ERROR")}));return function(){return e.apply(this,arguments)}}(),i.fetchBalanceDetails=function(){var e=(0,l.default)((function*(){var e,t=this,n=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).useRecycleBalance,r=yield Promise.all([this.getDbAccount(),this.getNetwork()]),o=(0,s.default)(r,2),i=o[0],a=o[1],u=yield this.getRecycleInscriptionUtxos(i.xpub),c=yield this.collectUTXOsInfo(n?{forceSelectUtxos:u.map((function(e){var t=e.key.split("_"),n=(0,s.default)(t,2),r=n[0],o=n[1];return{txId:r,vout:parseInt(o,10),address:i.address}}))}:void 0),d=c.utxos,l=c.valueDetails,f=c.ordQueryStatus;"ERROR"===f&&this.collectUTXOsInfo.clear();var p=yield this.getFrozenUtxos(i.xpub,d),v=d.filter((function(e){return p.find((function(n){return n.id===(0,B.getUtxoId)(t.networkId,e)}))})).reduce((function(e,t){return e.plus(t.value)}),new(g())(0)),h=v;null!=l&&l.unavailableValue&&(h=h.plus(null==l?void 0:l.unavailableValue));var y,w,m,I=(0,j.convertFeeValueToNative)({value:v,network:a}),T=(0,j.convertFeeValueToNative)({value:h,network:a}),x=d.reduce((function(e,t){return e.plus(t.value)}),new(g())(0)),b=(0,j.convertFeeValueToNative)({value:null!=(e=null==l?void 0:l.totalValue)?e:x,network:a}),A=new(g())(b).minus(T).toFixed();if(l){var E=l.unavailableValueOfUnchecked,k=l.unavailableValueOfUnconfirmed,C=l.unavailableValueOfInscription,O=function(e){return e&&new(g())(e).gt(0)};O(E)&&(m=(0,j.convertFeeValueToNative)({value:E,network:a})),O(k)&&(y=(0,j.convertFeeValueToNative)({value:k,network:a})),O(C)&&(w=(0,j.convertFeeValueToNative)({value:C,network:a}))}var P={errorMessageKey:"ERROR"===f?"msg__the_ordinal_service_failure_refresh_and_try_again":void 0,total:b,available:A,unavailable:T,unavailableOfLocalFrozen:I,unavailableOfInscription:w,unavailableOfUnconfirmed:y,unavailableOfUnchecked:m};return Promise.resolve(P)}));return function(){return e.apply(this,arguments)}}(),i.getUserNFTAssets=function(){var e=(0,l.default)((function*(e){var t=e.serviceData;return Promise.resolve({type:R.NFTAssetType.BTC,data:t})}));return function(t){return e.apply(this,arguments)}}(),(0,f.default)(n)}(M.VaultBase)},882914:(e,t,n)=>{n.r(t),n.d(t,{BlockBook:()=>r.BlockBook,Provider:()=>o.Provider});var r=n(331489),o=n(281590)},153546:(e,t,n)=>{n.r(t),n.d(t,{convertDeviceError:()=>u});var r=n(703599),o=n(302478),i=n(292147);n(213208);function a(e,t){return"string"!==typeof t?null:e===r.HardwareErrorCode.DeviceInitializeFailed&&t.includes("ECONNABORTED")?new o.ConnectTimeoutError({message:t}):t.includes("Bridge network error")?new o.BridgeNetworkError({message:t}):null}function u(e){var t,n=e||{},u=n.code,s=n.error,c=n.message,d=null!=(t=null!=s?s:c)?t:"Unknown error";if(a(u,d))return a(u,d);switch(i.default.hardwareSDK.info("Device Utils Convert Device Error:",u,d),u){case r.HardwareErrorCode.UnknownError:return new o.UnknownHardwareError(e);case r.HardwareErrorCode.DeviceFwException:return new o.FirmwareVersionTooLow(e);case r.HardwareErrorCode.DeviceUnexpectedMode:return"string"===typeof d&&-1!==d.indexOf("ui-device_bootloader_mode")?new o.NotInBootLoaderMode(e):new o.UnknownHardwareError(e);case r.HardwareErrorCode.DeviceCheckDeviceIdError:return new o.DeviceNotSame(e);case r.HardwareErrorCode.DeviceNotFound:return new o.DeviceNotFind(e);case r.HardwareErrorCode.DeviceUnexpectedBootloaderMode:return new o.NotInBootLoaderMode(e);case r.HardwareErrorCode.DeviceInterruptedFromOutside:case r.HardwareErrorCode.DeviceInterruptedFromUser:return new o.UserCancelFromOutside(e);case r.HardwareErrorCode.DeviceNotSupportPassphrase:return new o.NotSupportPassphraseError(e);case r.HardwareErrorCode.IFrameLoadFail:return new o.InitIframeLoadFail(e);case r.HardwareErrorCode.IframeTimeout:return new o.InitIframeTimeout(e);case r.HardwareErrorCode.FirmwareUpdateDownloadFailed:return new o.FirmwareDownloadFailed(e);case r.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot:return new o.FirmwareUpdateManuallyEnterBoot(e);case r.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure:return new o.FirmwareUpdateAutoEnterBootFailure(e);case r.HardwareErrorCode.FirmwareUpdateLimitOneDevice:return new o.FirmwareUpdateLimitOneDevice(e);case r.HardwareErrorCode.CallMethodNeedUpgradeFirmware:return new o.FirmwareVersionTooLow(e);case r.HardwareErrorCode.NewFirmwareUnRelease:return new o.NewFirmwareUnRelease(e);case r.HardwareErrorCode.NewFirmwareForceUpdate:return new o.NewFirmwareForceUpdate(e);case r.HardwareErrorCode.NetworkError:return new o.NetworkError(e);case r.HardwareErrorCode.BlePermissionError:return new o.NeedBluetoothTurnedOn(e);case r.HardwareErrorCode.BleLocationError:return new o.NeedBluetoothPermissions({message:d});case r.HardwareErrorCode.BleLocationServicesDisabled:return new o.BleLocationServiceError({message:d});case r.HardwareErrorCode.BleDeviceNotBonded:return new o.DeviceNotBonded(e);case r.HardwareErrorCode.BleDeviceBondError:return new o.DeviceBondError(e);case r.HardwareErrorCode.BleWriteCharacteristicError:return new o.BleWriteCharacteristicError(e);case r.HardwareErrorCode.BleScanError:return new o.BleScanError({message:d});case r.HardwareErrorCode.BleAlreadyConnected:return new o.BleAlreadyConnectedError(e);case r.HardwareErrorCode.RuntimeError:return-1!==d.indexOf("EIP712 blind sign is disabled")?new o.OpenBlindSign(e):-1!==d.indexOf("Unknown message")||-1!==d.indexOf("Failure_UnexpectedMessage")?new o.UnknownMethod(e):new o.UnknownHardwareError(e);case r.HardwareErrorCode.PinInvalid:return new o.InvalidPIN(e);case r.HardwareErrorCode.DeviceCheckPassphraseStateError:return new o.InvalidPassphrase(e);case r.HardwareErrorCode.DeviceOpenedPassphrase:return new o.DeviceOpenedPassphrase(e);case r.HardwareErrorCode.DeviceNotOpenedPassphrase:return new o.DeviceNotOpenedPassphrase(e);case r.HardwareErrorCode.PinCancelled:case r.HardwareErrorCode.ActionCancelled:return new o.UserCancel(e);case r.HardwareErrorCode.BridgeNotInstalled:case o.CustomOneKeyHardwareError.NeedOneKeyBridge:return new o.NeedOneKeyBridge(e);case r.HardwareErrorCode.BridgeNetworkError:return new o.BridgeNetworkError(e);case r.HardwareErrorCode.BridgeTimeoutError:return new o.BridgeTimeoutError(e);case r.HardwareErrorCode.PollingTimeout:return new o.ConnectTimeoutError(e);case r.HardwareErrorCode.PollingStop:return new o.ConnectPollingStopError(e);case r.HardwareErrorCode.BlindSignDisabled:return new o.OpenBlindSign(e);case r.HardwareErrorCode.FileAlreadyExists:return new o.FileAlreadyExistError(e);case r.HardwareErrorCode.CheckDownloadFileError:return new o.IncompleteFileError(e);case r.HardwareErrorCode.NotInSigningMode:return new o.NotInSigningModeError(e);default:return new o.UnknownHardwareError(e)}}}}]);